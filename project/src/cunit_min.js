function CUnit(a,b,c,d,e){THREE.Object3D.call(this);this.type="CUnit";this.color=this.getColorPerWeight(d);this.opacity=1;this.geometry=GEO_CUBE;this.cell_x=b;this.cell_y=a;this.time_step=c;this.zscore=d;this.bearing=this.calcBearing();this.angularDistance=this.calcAngularDistance();this.latitude=this.calcLatitude();this.longitude=this.calcLongitude();this.time_stamp=this.calcTime();this.mesh=new THREE.Mesh(this.geometry,new THREE.MeshPhongMaterial({color:this.color,transparent:!0,opacity:this.opacity,
blending:THREE.NoBlending}));this.mesh.name="<h3><strong>CUnit Information</strong></h3><p>"+("<strong>Longitude:</strong> "+this.getLongitude()+"<br/>")+("<strong>Latitude:</strong> "+this.getLatitude()+"<br/>")+("<strong>Time step:</strong> "+this.time_stamp.toLocaleString()+"<br/>")+("<strong>zScore:</strong> "+d+"<br/>")+"</p>";this.mesh.position.x=this.cell_y*dimensionZ-offsetX;this.mesh.position.z=-this.cell_x*dimensionX-offsetZ;this.mesh.position.y=this.time_step*dimensionY-offsetY;this.mesh.renderOrder=
2;this.currentSize=this.mesh.scale.x}CUnit.prototype=Object.create(THREE.Mesh.prototype);CUnit.prototype.constructor=CUnit;CUnit.prototype.getMesh=function(){return this.mesh};CUnit.prototype.changeGeometry=function(a){this.mesh.geometry=a};
CUnit.prototype.getColorPerWeight=function(a){if(-2.58>a)return a=(-2.58-ZSCORE_LOWER_BOUND)/(-2.58-a),new THREE.Color("rgb("+Math.round(51/a)+", "+Math.round(102/a)+", "+Math.round(204*a)+")");if(-2.58<=a&&-1.96>a)return new THREE.Color(10066380);if(-1.96<=a&&-1.65>a)return new THREE.Color(12632256);if(-1.65<=a&&1.65>a)return new THREE.Color(16777164);if(1.65<=a&&1.96>a)return new THREE.Color(16764057);if(1.96<=a&&2.58>a)return new THREE.Color(16737894);a=(ZSCORE_UPPER_BOUND-2.58)/(a-2.58);return new THREE.Color("rgb("+
Math.round(204*a)+", "+Math.round(51/a)+", "+Math.round(51/a)+")")};CUnit.prototype.reinitiate=function(){this.mesh.material=new THREE.MeshPhongMaterial({color:this.color,transparent:!0,opacity:this.opacity,blending:THREE.NoBlending})};CUnit.prototype.setCunitSize=function(a,b,c){this.mesh.scale.set(c,b,a);this.currentSize=this.mesh.scale.x};CUnit.prototype.getCellY=function(){return this.cell_y};CUnit.prototype.getCellX=function(){return this.cell_x};CUnit.prototype.getTimeStep=function(){return this.time_step};
CUnit.prototype.getZScore=function(){return this.zscore};CUnit.prototype.getScalePerWeight=function(){return(this.zscore-ZSCORE_LOWER_BOUND)*sizeTime/ZSCORE_SCALE};CUnit.prototype.calcLatitude=function(){return getLatitudePoint(this.cell_y,!0)};CUnit.prototype.calcLongitude=function(){return getLongitudePoint(this.cell_x,!0)};CUnit.prototype.calcAngularDistance=function(){return getAngleDistance(this.cell_x,this.cell_y)};CUnit.prototype.calcTime=function(){return getTimeStampFromStep(this.time_step)};
CUnit.prototype.calcBearing=function(){return Math.atan2(this.cell_x,this.cell_y)};CUnit.prototype.getLongitude=function(){return THREE.Math.radToDeg(this.longitude).toFixed(6)};CUnit.prototype.getLatitude=function(){return THREE.Math.radToDeg(this.latitude).toFixed(6)};CUnit.prototype.getAngularDistance=function(){return THREE.Math.radToDeg(this.angularDistance)};CUnit.prototype.getBearing=function(){return this.bearing};CUnit.prototype.getCurrentSize=function(){return this.currentSize};
